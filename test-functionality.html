<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Functionality Test - Consciousness Revolution</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/inter/3.15.0/inter.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- All Services -->
    <script src="js/consciousness-api.js"></script>
    <script src="js/auth-service.js"></script>
    <script src="js/database-service.js"></script>
    <link rel="stylesheet" href="css/consciousness-live.css">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0014;
            color: white;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .test-section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(153,50,204,0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .test-button {
            background: linear-gradient(135deg, #9932CC, #FFD700);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem;
            font-weight: 600;
        }
        
        .test-result {
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { color: #00FF88; }
        .error { color: #ff6b6b; }
        .info { color: #FFD700; }
    </style>
</head>
<body>
    <h1>üß† Consciousness Revolution - Functionality Test Suite</h1>
    <p>Testing all platform functionality to ensure everything works perfectly.</p>

    <!-- API Tests -->
    <div class="test-section">
        <h2>üåê API Connectivity Tests</h2>
        <button class="test-button" onclick="testConsciousnessAPI()">Test Consciousness API</button>
        <button class="test-button" onclick="testAnalyticsAPI()">Test Analytics API</button>
        <button class="test-button" onclick="testStatusAPI()">Test Status API</button>
        <div class="test-result" id="api-results">Click buttons to test API endpoints...</div>
    </div>

    <!-- Authentication Tests -->
    <div class="test-section">
        <h2>üîê Authentication Tests</h2>
        <button class="test-button" onclick="testAuthService()">Test Auth Service</button>
        <button class="test-button" onclick="testUserRegistration()">Test Registration</button>
        <button class="test-button" onclick="testUserLogin()">Test Login</button>
        <div class="test-result" id="auth-results">Click buttons to test authentication...</div>
    </div>

    <!-- Database Tests -->
    <div class="test-section">
        <h2>üíæ Database Tests</h2>
        <button class="test-button" onclick="testDatabaseService()">Test Database Service</button>
        <button class="test-button" onclick="testDataStorage()">Test Data Storage</button>
        <button class="test-button" onclick="testDataRetrieval()">Test Data Retrieval</button>
        <div class="test-result" id="database-results">Click buttons to test database functionality...</div>
    </div>

    <!-- Integration Tests -->
    <div class="test-section">
        <h2>üîó Integration Tests</h2>
        <button class="test-button" onclick="testFullWorkflow()">Test Complete Workflow</button>
        <button class="test-button" onclick="testConsciousnessAmplification()">Test Consciousness Amplification</button>
        <button class="test-button" onclick="testRealTimeUpdates()">Test Real-time Updates</button>
        <div class="test-result" id="integration-results">Click buttons to test integrations...</div>
    </div>

    <!-- Performance Tests -->
    <div class="test-section">
        <h2>‚ö° Performance Tests</h2>
        <button class="test-button" onclick="testResponseTimes()">Test Response Times</button>
        <button class="test-button" onclick="testLoadHandling()">Test Load Handling</button>
        <button class="test-button" onclick="testMemoryUsage()">Test Memory Usage</button>
        <div class="test-result" id="performance-results">Click buttons to test performance...</div>
    </div>

    <script>
        // Utility functions
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            container.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // API Tests
        async function testConsciousnessAPI() {
            clearResults('api-results');
            logResult('api-results', 'üß† Testing Consciousness API...', 'info');
            
            try {
                const response = await fetch('https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/consciousness');
                const data = await response.json();
                
                if (response.ok) {
                    logResult('api-results', '‚úÖ Consciousness API working!', 'success');
                    logResult('api-results', `Status: ${data.status}`, 'success');
                    logResult('api-results', `AI Agents: ${Object.keys(data.aiAgents).length} active`, 'success');
                } else {
                    logResult('api-results', `‚ùå API Error: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult('api-results', `‚ùå Connection Error: ${error.message}`, 'error');
            }
        }

        async function testAnalyticsAPI() {
            logResult('api-results', 'üìä Testing Analytics API...', 'info');
            
            try {
                const response = await fetch('https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/analytics');
                const data = await response.json();
                
                if (response.ok) {
                    logResult('api-results', '‚úÖ Analytics API working!', 'success');
                    logResult('api-results', `Active Users: ${data.realTimeMetrics.activeUsers}`, 'success');
                    logResult('api-results', `Solar Generation: ${data.solarData.currentGeneration}kW`, 'success');
                } else {
                    logResult('api-results', `‚ùå API Error: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult('api-results', `‚ùå Connection Error: ${error.message}`, 'error');
            }
        }

        async function testStatusAPI() {
            logResult('api-results', '‚ö° Testing Status API...', 'info');
            
            try {
                const response = await fetch('https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/status');
                const data = await response.json();
                
                if (response.ok) {
                    logResult('api-results', '‚úÖ Status API working!', 'success');
                    logResult('api-results', `Platform Status: ${data.status}`, 'success');
                } else {
                    logResult('api-results', `‚ùå API Error: ${response.status}`, 'error');
                }
            } catch (error) {
                logResult('api-results', `‚ùå Connection Error: ${error.message}`, 'error');
            }
        }

        // Authentication Tests
        function testAuthService() {
            clearResults('auth-results');
            logResult('auth-results', 'üîê Testing Authentication Service...', 'info');
            
            if (window.authService) {
                logResult('auth-results', '‚úÖ Auth Service loaded', 'success');
                logResult('auth-results', `Authenticated: ${window.authService.isUserAuthenticated()}`, 'info');
                logResult('auth-results', `Current User: ${window.authService.currentUser?.name || 'None'}`, 'info');
            } else {
                logResult('auth-results', '‚ùå Auth Service not loaded', 'error');
            }
        }

        async function testUserRegistration() {
            logResult('auth-results', 'üìù Testing User Registration...', 'info');
            
            try {
                const testUser = {
                    email: `test${Date.now()}@consciousness.ai`,
                    password: 'testpass123',
                    name: 'Test User'
                };
                
                const result = await window.authService.register(testUser);
                
                if (result.success) {
                    logResult('auth-results', '‚úÖ Registration successful!', 'success');
                    logResult('auth-results', `User ID: ${result.user.id}`, 'success');
                } else {
                    logResult('auth-results', '‚ùå Registration failed', 'error');
                }
            } catch (error) {
                logResult('auth-results', `‚ùå Registration Error: ${error.message}`, 'error');
            }
        }

        async function testUserLogin() {
            logResult('auth-results', 'üîë Testing User Login...', 'info');
            
            try {
                const credentials = {
                    email: 'test@consciousness.ai',
                    password: 'testpass123'
                };
                
                const result = await window.authService.login(credentials);
                
                if (result.success) {
                    logResult('auth-results', '‚úÖ Login successful!', 'success');
                    logResult('auth-results', `Welcome: ${result.user.name}`, 'success');
                } else {
                    logResult('auth-results', '‚ùå Login failed', 'error');
                }
            } catch (error) {
                logResult('auth-results', `‚ùå Login Error: ${error.message}`, 'error');
            }
        }

        // Database Tests
        function testDatabaseService() {
            clearResults('database-results');
            logResult('database-results', 'üíæ Testing Database Service...', 'info');
            
            if (window.databaseService) {
                logResult('database-results', '‚úÖ Database Service loaded', 'success');
                
                const stats = window.databaseService.getStorageStats();
                logResult('database-results', `Storage: ${stats.formattedSize} (${stats.itemCount} items)`, 'info');
            } else {
                logResult('database-results', '‚ùå Database Service not loaded', 'error');
            }
        }

        async function testDataStorage() {
            logResult('database-results', 'üíæ Testing Data Storage...', 'info');
            
            try {
                const testData = {
                    consciousnessLevel: 5.5,
                    breakthroughs: 10,
                    testTimestamp: new Date().toISOString()
                };
                
                const success = await window.databaseService.storeUserData('test-user', testData);
                
                if (success) {
                    logResult('database-results', '‚úÖ Data storage successful!', 'success');
                } else {
                    logResult('database-results', '‚ùå Data storage failed', 'error');
                }
            } catch (error) {
                logResult('database-results', `‚ùå Storage Error: ${error.message}`, 'error');
            }
        }

        async function testDataRetrieval() {
            logResult('database-results', 'üìñ Testing Data Retrieval...', 'info');
            
            try {
                const userData = await window.databaseService.getUserData('test-user');
                
                if (userData) {
                    logResult('database-results', '‚úÖ Data retrieval successful!', 'success');
                    logResult('database-results', `Consciousness Level: ${userData.consciousnessLevel}`, 'info');
                } else {
                    logResult('database-results', '‚ö†Ô∏è No data found (expected for new users)', 'info');
                }
            } catch (error) {
                logResult('database-results', `‚ùå Retrieval Error: ${error.message}`, 'error');
            }
        }

        // Integration Tests
        async function testFullWorkflow() {
            clearResults('integration-results');
            logResult('integration-results', 'üîó Testing Complete Workflow...', 'info');
            
            try {
                // 1. Initialize services
                logResult('integration-results', '1. Initializing services...', 'info');
                const apiReady = await window.consciousnessAPI.initialize();
                
                if (apiReady) {
                    logResult('integration-results', '‚úÖ API initialized', 'success');
                } else {
                    logResult('integration-results', '‚ö†Ô∏è API in demo mode', 'info');
                }
                
                // 2. Test consciousness amplification
                logResult('integration-results', '2. Testing consciousness amplification...', 'info');
                const result = await window.consciousnessAPI.amplifyConsciousness('Test amplification');
                
                if (result) {
                    logResult('integration-results', '‚úÖ Consciousness amplified!', 'success');
                    logResult('integration-results', `Message: ${result.message}`, 'info');
                }
                
                // 3. Test analytics
                logResult('integration-results', '3. Testing analytics...', 'info');
                const analytics = await window.consciousnessAPI.getAnalytics();
                
                if (analytics) {
                    logResult('integration-results', '‚úÖ Analytics retrieved!', 'success');
                    logResult('integration-results', `Active Users: ${analytics.realTimeMetrics?.activeUsers}`, 'info');
                }
                
                logResult('integration-results', 'üéâ Complete workflow test successful!', 'success');
                
            } catch (error) {
                logResult('integration-results', `‚ùå Workflow Error: ${error.message}`, 'error');
            }
        }

        async function testConsciousnessAmplification() {
            logResult('integration-results', 'üß† Testing Consciousness Amplification...', 'info');
            
            try {
                const startTime = performance.now();
                const result = await window.consciousnessAPI.amplifyConsciousness('Test consciousness amplification functionality');
                const endTime = performance.now();
                
                logResult('integration-results', '‚úÖ Amplification successful!', 'success');
                logResult('integration-results', `Response time: ${Math.round(endTime - startTime)}ms`, 'info');
                logResult('integration-results', `Status: ${result.status}`, 'info');
                
            } catch (error) {
                logResult('integration-results', `‚ùå Amplification Error: ${error.message}`, 'error');
            }
        }

        async function testRealTimeUpdates() {
            logResult('integration-results', 'üîÑ Testing Real-time Updates...', 'info');
            
            try {
                let updateCount = 0;
                const maxUpdates = 3;
                
                const interval = setInterval(async () => {
                    try {
                        const analytics = await window.consciousnessAPI.getAnalytics();
                        updateCount++;
                        
                        logResult('integration-results', `Update ${updateCount}: Active Users = ${analytics.realTimeMetrics?.activeUsers}`, 'success');
                        
                        if (updateCount >= maxUpdates) {
                            clearInterval(interval);
                            logResult('integration-results', '‚úÖ Real-time updates working!', 'success');
                        }
                    } catch (error) {
                        clearInterval(interval);
                        logResult('integration-results', `‚ùå Update Error: ${error.message}`, 'error');
                    }
                }, 2000);
                
            } catch (error) {
                logResult('integration-results', `‚ùå Real-time Error: ${error.message}`, 'error');
            }
        }

        // Performance Tests
        async function testResponseTimes() {
            clearResults('performance-results');
            logResult('performance-results', '‚ö° Testing Response Times...', 'info');
            
            const tests = [
                { name: 'Consciousness API', url: 'https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/consciousness' },
                { name: 'Analytics API', url: 'https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/analytics' },
                { name: 'Status API', url: 'https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/status' }
            ];
            
            for (const test of tests) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(test.url);
                    const endTime = performance.now();
                    
                    const responseTime = Math.round(endTime - startTime);
                    
                    if (response.ok) {
                        const status = responseTime < 1000 ? 'success' : responseTime < 2000 ? 'info' : 'error';
                        logResult('performance-results', `${test.name}: ${responseTime}ms`, status);
                    } else {
                        logResult('performance-results', `${test.name}: Error ${response.status}`, 'error');
                    }
                } catch (error) {
                    logResult('performance-results', `${test.name}: ${error.message}`, 'error');
                }
            }
        }

        function testLoadHandling() {
            logResult('performance-results', 'üîÑ Testing Load Handling...', 'info');
            
            const promises = [];
            const requestCount = 5;
            
            for (let i = 0; i < requestCount; i++) {
                promises.push(
                    fetch('https://1ds08u5fi9.execute-api.us-east-1.amazonaws.com/prod/consciousness')
                        .then(response => ({ success: response.ok, status: response.status }))
                        .catch(error => ({ success: false, error: error.message }))
                );
            }
            
            Promise.all(promises).then(results => {
                const successful = results.filter(r => r.success).length;
                logResult('performance-results', `Load test: ${successful}/${requestCount} requests successful`, 
                    successful === requestCount ? 'success' : 'error');
            });
        }

        function testMemoryUsage() {
            logResult('performance-results', 'üíæ Testing Memory Usage...', 'info');
            
            if (performance.memory) {
                const memory = performance.memory;
                logResult('performance-results', `Used: ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB`, 'info');
                logResult('performance-results', `Total: ${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB`, 'info');
                logResult('performance-results', `Limit: ${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)}MB`, 'info');
            } else {
                logResult('performance-results', 'Memory API not available in this browser', 'info');
            }
            
            // Test localStorage usage
            const stats = window.databaseService?.getStorageStats();
            if (stats) {
                logResult('performance-results', `LocalStorage: ${stats.formattedSize}`, 'info');
            }
        }

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                logResult('api-results', 'üöÄ Auto-testing basic functionality...', 'info');
                testConsciousnessAPI();
            }, 1000);
        });
    </script>
</body>
</html>
